<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ÄÄƒng nháº­p Tool AI</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/style.css">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Tool AI">
  <link rel="apple-touch-icon" href="assets/icon-192.png">

  <script>
    function isIOSDevice() {
      //return /iPhone|iPad|iPod/i.test(navigator.userAgent);
      return true;
    }

    if (!isIOSDevice()) {
      window.location.href = "unsupported.html";
    }
  </script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ABC123XYZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    // Khá»Ÿi táº¡o GA4
    gtag('config', 'G-ABC123XYZ', {
      send_page_view: true
    });
  </script>
</head>

<body class="d-flex justify-content-center align-items-center vh-100">

  <div id="login-box" class="text-center p-4 card shadow-sm" style="max-width: 400px; width: 100%;">
    <img src="/assets/ic_launcher_round.png" alt="Logo Tool AI" class="mb-4" style="width: 100px; height: 100px;">

    <h5 class="mb-3 font-weight-bold">ÄÄƒng nháº­p Tool AI</h5>

    <!-- Google login -->
    <p>ÄÄƒng nháº­p nhanh (1 cháº¡m) vá»›i</p>
    <div id="g_id_onload" data-client_id="806969458384-k9jefp2tnts2q2rqgobn2f1bi24t6fh5.apps.googleusercontent.com"
      data-callback="handleLogin" data-auto_prompt="false"></div>
    <div class="g_id_signin mb-4" data-type="standard"></div>

    <hr class="my-3">

    <!-- Email login form -->
    <form id="emailLoginForm" onsubmit="return handleEmailLogin(event)">
      <div class="form-group text-left">
        <label for="email">Email</label>
        <input type="email" id="email" class="form-control" placeholder="Nháº­p email cá»§a báº¡n" required>
      </div>
      <div class="form-group text-left">
        <label for="password">Máº­t kháº©u</label>
        <input type="password" id="password" class="form-control" placeholder="Nháº­p máº­t kháº©u" required>
      </div>
      <button type="submit" id="btnLogin" class="btn btn-primary btn-block mt-3">ÄÄƒng nháº­p</button>
    </form>

  <label id="loginStatus" class="mt-3 text-muted small"></label>

    <hr class="my-3">
    <a href="forgot-step1.html" class="d-block mt-3 small">QuÃªn máº­t kháº©u?</a>
    <a href="register-step1.html" class="d-block mt-3 small">ChÆ°a cÃ³ tÃ i khoáº£n? ÄÄƒng kÃ½ ngay</a>
  </div>

  <!-- loading overlay -->
  <div id="loading-overlay" style="
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0, 0, 0, 0.3);
    z-index: 9999;
    align-items: center;
    justify-content: center;
  ">
    <div class="spinner-border text-light" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
  <script src="js/utils-url.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/auth.js"></script>
  <script>
    (async function autoLoginCheck() {
      const token = localStorage.getItem("accessToken");
      const email = localStorage.getItem("userEmail");

      if (!token || !email) return;
      showLoading();
      try {
        const res = await fetch(getUrl() + "/api/auth/check-token", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token,
            "x-device-id": getDeviceId()
          }
        });

        const data = await res.json();
        if (data.valid) {
          console.log("âœ… Token há»£p lá»‡, tá»± Ä‘á»™ng Ä‘Äƒng nháº­p...");
          window.location.href = "dashboard.html?page=tool";
        } else {
          console.log("âŒ Token khÃ´ng há»£p lá»‡:", data.message);
          localStorage.removeItem("accessToken");
        }
        hideLoading();
      } catch (err) {
        console.error("Lá»—i kiá»ƒm tra token:", err);
        hideLoading();
      }
    })();
  </script>
  <script>
    function isIos() {
      //return /iphone|ipad|ipod/i.test(window.navigator.userAgent);
      return true;
    }

    function isInStandaloneMode() {
      return ('standalone' in window.navigator) && window.navigator.standalone;
    }

    function showAddToHomeScreenPrompt() {
      const guide = document.createElement('div');
      guide.id = 'ios-install-guide';
      guide.innerHTML = `
    <div class="guide-overlay">
      <div class="guide-box">
        <h3>ThÃªm Tool AI ra MÃ n hÃ¬nh chÃ­nh ğŸ“±</h3>
        <p>Äá»ƒ sá»­ dá»¥ng Ä‘áº§y Ä‘á»§ tÃ­nh nÄƒng (thÃ´ng bÃ¡o, tá»± Ä‘á»™ng, v.v), báº¡n cáº§n thÃªm á»©ng dá»¥ng ra mÃ n hÃ¬nh chÃ­nh.</p>
        <p>Nháº¥n biá»ƒu tÆ°á»£ng <img src="/assets/share-icon.png" alt="Share icon" class="icon-share"> sau Ä‘Ã³ chá»n <strong>ThÃªm vÃ o MÃ n hÃ¬nh chÃ­nh</strong>.</p>
        <button id="closeGuide">ÄÃ£ hiá»ƒu</button>
      </div>
    </div>
  `;
      document.body.appendChild(guide);

      document.getElementById('closeGuide').onclick = () => {
        guide.remove();
        localStorage.setItem('hideIosGuide', '1');
      };
    }

    // Cháº¡y khi load trang
    window.addEventListener('load', () => {
      if (isIos() && !isInStandaloneMode() && !localStorage.getItem('hideIosGuide')) {
        showAddToHomeScreenPrompt();
      }
    });

  </script>
</body>

</html>