<!-- pages/tooluse.html -->
<iframe id="game-frame" src="" style="position:absolute;top:0;left:0;width:100%;height:100%;border:none;z-index: 1;"></iframe>

<div id="floating-view" style="
  position: fixed;
  top: 20px;
  left: 20px;
  background: rgba(0,0,0,0.5);
  color: white;
  padding: 12px 16px;
  border-radius: 10px;
  z-index: 99999;
  max-width: 300px;
  cursor: move;
  touch-action: none;
  -webkit-user-select: none;
  user-select: none;">
  
  <button id="close-btn" style="position:absolute;top:6px;right:10px;background:none;border:none;color:white;font-size:18px;" onclick="loadPage('tool')">×</button>
  <h5 id="gateway-name">...</h5>
  <div id="prediction-result">Kết quả: ?</div>
  <button onclick="fetchPrediction()">Lấy kết quả</button>
</div>

<script>
  var gateways = {
    zon88: { name: "Zon88", url: "https://antambao.com" },
    vuabai: { name: "Vua Bài", url: "https://toolsicbo.com" }
  };

  function getQueryParam(name) {
    var urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }
  var gatewayId = getQueryParam("gateway");
  var gateway = gateways[gatewayId];
  console.log("gateway: " + gateway);

  if (gateway) {
    $("#game-frame").attr("src", gateway.url);
    $("#gateway-name").text(gateway.name);
  } else {
    alert("Không tìm thấy cổng game!");
    loadPage("tool");
  }

  function fetchPrediction() {
    const token = localStorage.getItem("accessToken") || "";
    fetch(`${getUrl()}/api/tool/predict?gateway=${gatewayId}`, {
      headers: { Authorization: "Bearer " + token }
    })
      .then(res => res.json())
      .then(data => {
        $("#prediction-result").text(`Kết quả: ${data.choice}`);
      })
      .catch(() => {
        $("#prediction-result").text("Không thể lấy kết quả");
      });
  }

  $(document).ready(() => {
    makeDraggable(document.getElementById("floating-view"));
  });
</script>